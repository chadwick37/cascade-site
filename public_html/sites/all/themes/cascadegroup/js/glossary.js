(function(b){b.fn.glossary=function(a,c){c=b.extend({ignorecase:!1,tiptag:"h6",excludetags:[],linktarget:"_blank",showonce:!1,escapeclose:!0},c);var l=1;return this.each(function(n,g){b.each(c.excludetags,function(d,b){c.excludetags[d]=b.toUpperCase()});var p=function(d,a,k,g){var h=a,f=0;if(3==d.nodeType){var m=c.ignorecase?d.data.toLowerCase().indexOf(h.toLowerCase()):d.data.indexOf(h);if(0<=m&&!(-1<jQuery.inArray(b(d).parent().get(0).tagName,c.excludetags))){var e=document.createElement("a");e.className=
"glossaryTerm";"0"==k?(e.id="glossaryID"+l,e.href="#",e.title="Click for '"+a+"' definition",e.className="glossaryTerm",b(e).click(function(d){b.glossaryTip(e,"<"+c.tiptag+">"+a+"</"+c.tiptag+"><p>"+g+"</p>",{mouse_event:d},c);return!1})):"1"==k?(e.title="Click to look up '"+a+"' in Wikipedia",a=a.replace(/ /g,"_"),e.href="http://en.wikipedia.org/wiki/"+a,e.target=c.linktarget):"2"==k?(e.title="Click to search for '"+a+"' in Google",a=a.replace(/ /g,"+"),e.href="http://www.google.co.uk/search?q="+
a,e.target=c.linktarget):"3"==k&&(e.title="Click to view '"+a+"' definition",e.href=g,e.target=c.linktarget);d=d.splitText(m);d.splitText(h.length);k=d.cloneNode(!0);e.appendChild(k);d.parentNode.replaceChild(e,d);f=1;l+=1}}else if(1==d.nodeType&&d.childNodes&&!/(script|style)/i.test(d.tagName))for(h=0;h<d.childNodes.length;++h)m=p(d.childNodes[h],a,k,g),c.showonce&&1==m?(h=d.childNodes.length,f=1):h+=m;return f};b.ajax({type:"GET",url:a,dataType:"json",success:function(a){if(a)for(var c=a.length,
b=0;b<c;b++){var f=a[b];p(g,f.term,f.type,f.definition)}},error:function(){}})})};var a=function(){};b.extend(a.prototype,{setup:function(){b("#glossaryTip").length&&b("#glossaryTip").remove();a.holder=b('<div id="glossaryTip" style="max-width:260px;"><div id="glossaryClose"></div></div>');a.content=b('<div id="glossaryContent"></div>');b("body").append(a.holder.append(a.content))},show:function(f,c,l,n){a.content.html(c);c=b(f).position();f=parseInt(c.left)+15;c=parseInt(c.top)+15;a.holder.css({top:c,
left:f});a.holder.is(":hidden")&&a.holder.show();a.holder.bind("click",function(){a.holder.stop(!0).fadeOut(200);return!1});n.escapeclose&&b(document).bind("keydown",function(b){if(27==b.keyCode)return a.holder.stop(!0).fadeOut(200),!1})}});b.glossaryTip=function(f,c,l,n){var g=b.glossaryTip.instance;g||(g=b.glossaryTip.instance=new a);g.setup();g.show(f,c,l,n);return g}})(jQuery);